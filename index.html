<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–≥—Ä–∞ –ú–µ–º–æ—Ä–∏. –ò–≥—Ä–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–∞–º—è—Ç–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–±–æ—Ä–∞—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="vendor/react.development.js"></script>
  <script src="vendor/react-dom.development.js"></script>
  <script src="vendor/babel.min.js"></script>
  <script src="js/data.js"></script>
  <script src="js/setting.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<App images={images}/>);

    function App({images = []}) {
      // üéØ –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –≤ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç (React best practice –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
      const [gameState, setGameState] = React.useState({
        openedCards: [],        // –û—Ç–∫—Ä—ã—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–º–∞–∫—Å–∏–º—É–º 2)
        matchedCards: [],       // –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫
        moves: 0,               // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö–æ–¥–æ–≤
        errors: 0,              // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
        isGameOver: false,      // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞?
        isWin: false           // –ò–≥—Ä–æ–∫ –ø–æ–±–µ–¥–∏–ª?
      });

      // ‚è∞ useEffect: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø–∞—Ä —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
      React.useEffect(() => {
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ —Ä–æ–≤–Ω–æ 2 –∫–∞—Ä—Ç–æ—á–∫–∏ - –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ú–ì–ù–û–í–ï–ù–ù–û
        if (gameState.openedCards.length === 2) {
          // üöÄ –ú–ì–ù–û–í–ï–ù–ù–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä—ã (–¥–ª—è –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤)
          checkPair();
        }
      }, [gameState.openedCards]); // –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: —Å–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ openedCards

      // üîç –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫
      const checkPair = () => {
        const [cardId1, cardId2] = gameState.openedCards; // –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞

        // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –∏—Ö ID –≤ –º–∞—Å—Å–∏–≤–µ images
        const card1 = images.find(img => img.id === cardId1);
        const card2 = images.find(img => img.id === cardId2);

        // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
        const isPairMatch = card1.url === card2.url;

        if (isPairMatch) {
          // üéâ –ü–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞! –ú–ì–ù–û–í–ï–ù–ù–û –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
          setGameState(prevState => {
            const newMatchedCards = [...prevState.matchedCards, cardId1, cardId2];
            const totalCards = images.length;
            const isGameWon = newMatchedCards.length === totalCards; // –í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞–π–¥–µ–Ω—ã?

            return {
              ...prevState,
              matchedCards: newMatchedCards,
              openedCards: [], // –ú–ì–ù–û–í–ï–ù–ù–û –æ—á–∏—â–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
              isWin: isGameWon,
              isGameOver: isGameWon // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø—Ä–∏ –ø–æ–±–µ–¥–µ
            };
          });
        } else {
          // üíî –ü–∞—Ä–∞ –Ω–µ –ø–æ–¥–æ—à–ª–∞! –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
          setTimeout(() => {
            setGameState(prevState => {
              const newErrors = prevState.errors + 1;
              const isGameLost = newErrors >= GAME_SETTINGS.LIVES_COUNT; // –ö–æ–Ω—á–∏–ª–∏—Å—å –∂–∏–∑–Ω–∏?

              return {
                ...prevState,
                errors: newErrors,
                openedCards: [], // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ü–û–°–õ–ï –∑–∞–¥–µ—Ä–∂–∫–∏
                isGameOver: isGameLost // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø—Ä–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–∏
              };
            });
          }, GAME_SETTINGS.FLIP_DELAY); // –ó–∞–¥–µ—Ä–∂–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø–∞—Ä
        }
      };

      // üîÑ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ
      const handleCardClick = (cardId) => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º: –º–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?
        const isCardAlreadyOpen = gameState.openedCards.includes(cardId);
        const isCardMatched = gameState.matchedCards.includes(cardId);
        const gameIsOver = gameState.isGameOver;

        // –ï—Å–ª–∏ –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ –∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞/–Ω–∞–π–¥–µ–Ω–∞ - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫
        if (gameIsOver || isCardAlreadyOpen || isCardMatched) {
          return;
        }

        // üéØ –õ–û–ì–ò–ö–ê –ö–õ–ò–ö–ê –ü–û –ö–ê–†–¢–û–ß–ö–ê–ú —á–µ—Ä–µ–∑ switch case:
        switch (gameState.openedCards.length) {
          case 0:
            // –ü–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ - –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ–º
            setGameState(prevState => ({
              ...prevState,
              openedCards: [cardId],
              moves: prevState.moves + 1
            }));
            break;

          case 1:
            // –í—Ç–æ—Ä–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∏ checkPair —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ useEffect
            setGameState(prevState => ({
              ...prevState,
              openedCards: [...prevState.openedCards, cardId],
              moves: prevState.moves + 1
            }));
            break;

          default:
            // üöÄ –¢—Ä–µ—Ç—å—è –∫–∞—Ä—Ç–æ—á–∫–∞ - –°–ù–ê–ß–ê–õ–ê –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ, –ü–û–¢–û–ú –æ—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é
            const [cardId1, cardId2] = gameState.openedCards;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–∞—Ä—É –ú–ì–ù–û–í–ï–ù–ù–û
            const card1 = images.find(img => img.id === cardId1);
            const card2 = images.find(img => img.id === cardId2);
            const isPairMatch = card1.url === card2.url;

            if (isPairMatch) {
              // –ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–∞—Ä–∞ —Å–æ–≤–ø–∞–ª–∞ - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
              setGameState(prevState => {
                const newMatchedCards = [...prevState.matchedCards, cardId1, cardId2];
                const totalCards = images.length;
                const isGameWon = newMatchedCards.length === totalCards;

                return {
                  ...prevState,
                  matchedCards: newMatchedCards,
                  openedCards: [cardId], // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
                  moves: prevState.moves + 1,
                  isWin: isGameWon,
                  isGameOver: isGameWon
                };
              });
            } else {
              // –ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–∞—Ä–∞ –ù–ï —Å–æ–≤–ø–∞–ª–∞ - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—à–∏–±–∫–∏ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é
              setGameState(prevState => {
                const newErrors = prevState.errors + 1;
                const isGameLost = newErrors >= GAME_SETTINGS.LIVES_COUNT;

                return {
                  ...prevState,
                  errors: newErrors,
                  openedCards: [cardId], // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É (–ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–∫—Ä—ã–ª–∏—Å—å)
                  moves: prevState.moves + 1,
                  isGameOver: isGameLost
                };
              });
            }
            break;
        }
      };

      // üéÆ –°–±—Ä–æ—Å –∏–≥—Ä—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
      const resetGame = () => {
        setGameState({
          openedCards: [],
          matchedCards: [],
          moves: 0,
          errors: 0,
          isGameOver: false,
          isWin: false
        });
      };

      // üéØ –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–µ —Ö—Ä–∞–Ω–∏–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏!)
      const totalPairs = images.length / 2;
      const matchedPairs = gameState.matchedCards.length / 2;
      const progress = totalPairs > 0 ? (matchedPairs / totalPairs) * 100 : 0;
      const remainingLives = GAME_SETTINGS.LIVES_COUNT - gameState.errors;

      return (
        <section className="game container">
          <GameHeader 
            moves={gameState.moves}
            progress={progress}
            remainingLives={remainingLives}
            matchedPairs={matchedPairs}
            totalPairs={totalPairs}
          />
          
          <GameBoard 
            images={images}
            gameState={gameState}
            onCardClick={handleCardClick} 
          />

          {gameState.isGameOver && (
            <GameModal 
              isWin={gameState.isWin}
              moves={gameState.moves}
              matchedPairs={matchedPairs}
              onRestart={resetGame}
            />
          )}
        </section>
      );
    }

    // üìä –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —à–∞–ø–∫–∏ –∏–≥—Ä—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º (–æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ–¥ template)
    function GameHeader({ moves, progress, remainingLives, matchedPairs, totalPairs }) {
      return (
        <>
          <div className="progress-wrapper">
            <div className="progress" style={{ width: `${progress}%` }}></div>
          </div>
          <p className="progress-description">
            –û—Ç–∫—Ä—ã—Ç–æ <span>{matchedPairs}</span> / <span>{totalPairs}</span>
          </p>
          <div className="steps">–®–∞–≥ {moves}</div>
        </>
      );
    }

    // üéÆ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
    function GameBoard({ images = [], gameState, onCardClick }) {
      return (
        <ul className="cards cards-theme-cars">
          {images.map((item) => (
            <Card
              key={item.id}
              {...item}  // üéØ –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è: –ø–µ—Ä–µ–¥–∞–µ–º id, url, description
              isCardShow={gameState.openedCards.includes(item.id)}
              isCardFinished={gameState.matchedCards.includes(item.id)}
              onCardClick={onCardClick}
            />
          ))}
        </ul>
      );
    }

    // üé¥ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
    function Card({ id, url, description, isCardShow, isCardFinished, onCardClick }) {
      const cardClasses = `card ${isCardShow ? 'card-show' : ''} ${isCardFinished ? 'card-finished' : ''}`;
      
      return (
        <li 
          className={cardClasses} 
          onClick={() => onCardClick(id)}
        >
          <img src={url} width="204" height="144" alt={description} />
        </li>
      );
    }

    // üèÜ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (–æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ–¥ template)
    function GameModal({ isWin, moves, matchedPairs, onRestart }) {
      return (
        <div className="modal">
          <div className="modal-box">
            <h3 className="modal-caption">
              {isWin ? '–ü–æ–±–µ–¥–∞!' : '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞'}
            </h3>
            <p className="modal-description">
              {isWin 
                ? `–í—ã —Å–æ–±—Ä–∞–ª–∏ –≤—Å–µ –ø–∞—Ä—ã –∑–∞ ${moves} —à–∞–≥–æ–≤`
                : `–í—ã —Å–æ–±—Ä–∞–ª–∏ ${matchedPairs} –ø–∞—Ä`
              }
            </p>
            <button className="button modal-button" type="button" onClick={onRestart}>
              –ù–æ–≤–∞—è –∏–≥—Ä–∞
            </button>
          </div>
        </div>
      );
    }

  </script>
</body>
</html>