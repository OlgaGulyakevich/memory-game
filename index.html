<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–≥—Ä–∞ –ú–µ–º–æ—Ä–∏. –ò–≥—Ä–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–∞–º—è—Ç–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–±–æ—Ä–∞—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="vendor/react.development.js"></script>
  <script src="vendor/react-dom.development.js"></script>
  <script src="vendor/babel.min.js"></script>
  <script src="js/data.js"></script>
  <script src="js/setting.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<App images={images}/>);

    function App({images = []}) {
      // üéØ –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –≤ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç (React best practice –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
      const [gameState, setGameState] = React.useState({
        openedCards: [],        // –û—Ç–∫—Ä—ã—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–º–∞–∫—Å–∏–º—É–º 2)
        matchedCards: [],       // –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫
        moves: 0,               // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö–æ–¥–æ–≤
        errors: 0,              // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
        isGameOver: false,      // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞?
        isWin: false           // –ò–≥—Ä–æ–∫ –ø–æ–±–µ–¥–∏–ª?
      });

      // üîÑ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ (–í–°–Ø –ª–æ–≥–∏–∫–∞ —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å)
      const handleCardClick = (cardId) => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º: –º–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?
        const isCardAlreadyOpen = gameState.openedCards.includes(cardId);
        const isCardMatched = gameState.matchedCards.includes(cardId);
        const gameIsOver = gameState.isGameOver;

        // –ï—Å–ª–∏ –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ –∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞/–Ω–∞–π–¥–µ–Ω–∞ - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫
        if (gameIsOver || isCardAlreadyOpen || isCardMatched) {
          return;
        }

        // üéØ –ü–†–û–°–¢–ê–Ø –ò –ü–†–ï–î–°–ö–ê–ó–£–ï–ú–ê–Ø –õ–û–ì–ò–ö–ê:
        const currentOpenedCount = gameState.openedCards.length;

        if (currentOpenedCount === 0) {
          // 1Ô∏è‚É£ –ü–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ - –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ–º
          setGameState(prevState => ({
            ...prevState,
            openedCards: [cardId],
            moves: prevState.moves + 1
          }));

        } else if (currentOpenedCount === 1) {
          // 2Ô∏è‚É£ –í—Ç–æ—Ä–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ - –æ—Ç–∫—Ä—ã–≤–∞–µ–º, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä—É, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          const firstCardId = gameState.openedCards[0];
          const card1 = images.find(img => img.id === firstCardId);
          const card2 = images.find(img => img.id === cardId);
          const isPairMatch = card1.url === card2.url;

          if (isPairMatch) {
            // ‚úÖ –ü–∞—Ä–∞ —Å–æ–≤–ø–∞–ª–∞ - –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
            setGameState(prevState => {
              const newMatchedCards = [...prevState.matchedCards, firstCardId, cardId];
              const totalCards = images.length;
              const isGameWon = newMatchedCards.length === totalCards;

              return {
                ...prevState,
                matchedCards: newMatchedCards,
                openedCards: [], // –û—á–∏—â–∞–µ–º —Å—Ä–∞–∑—É
                moves: prevState.moves + 1,
                isWin: isGameWon,
                isGameOver: isGameWon
              };
            });
          } else {
            // ‚ùå –ü–∞—Ä–∞ –Ω–µ —Å–æ–≤–ø–∞–ª–∞ - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤—Ç–æ—Ä—É—é, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–µ, –ø–æ—Ç–æ–º –∑–∞–∫—Ä—ã–≤–∞–µ–º
            setGameState(prevState => ({
              ...prevState,
              openedCards: [firstCardId, cardId], // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–µ –∫–∞—Ä—Ç–æ—á–∫–∏
              moves: prevState.moves + 1
            }));

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ –∑–∞–¥–µ—Ä–∂–∫—É —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –æ—à–∏–±–æ–∫
            setTimeout(() => {
              setGameState(prevState => {
                const newErrors = prevState.errors + 1;
                const isGameLost = newErrors >= GAME_SETTINGS.LIVES_COUNT;

                return {
                  ...prevState,
                  errors: newErrors,
                  openedCards: [], // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ
                  isGameOver: isGameLost
                };
              });
            }, GAME_SETTINGS.FLIP_DELAY);
          }

        } else {
          // 3Ô∏è‚É£ –¢—Ä–µ—Ç—å—è –∫–∞—Ä—Ç–æ—á–∫–∞ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–∞—Ä—É, –ø–æ—Ç–æ–º –æ—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é
          const [prevCard1Id, prevCard2Id] = gameState.openedCards;
          const prevCard1 = images.find(img => img.id === prevCard1Id);
          const prevCard2 = images.find(img => img.id === prevCard2Id);
          const isPrevPairMatch = prevCard1.url === prevCard2.url;

          if (isPrevPairMatch) {
            // ‚úÖ –ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–∞—Ä–∞ —Å–æ–≤–ø–∞–ª–∞ - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ + –æ—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é
            setGameState(prevState => {
              const newMatchedCards = [...prevState.matchedCards, prevCard1Id, prevCard2Id];
              const totalCards = images.length;
              const isGameWon = newMatchedCards.length === totalCards;

              return {
                ...prevState,
                matchedCards: newMatchedCards,
                openedCards: [cardId], // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
                moves: prevState.moves + 1,
                isWin: isGameWon,
                isGameOver: isGameWon
              };
            });
          } else {
            // ‚ùå –ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–∞—Ä–∞ –Ω–µ —Å–æ–≤–ø–∞–ª–∞ - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—à–∏–±–∫–∏ + –æ—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é
            setGameState(prevState => {
              const newErrors = prevState.errors + 1;
              const isGameLost = newErrors >= GAME_SETTINGS.LIVES_COUNT;

              return {
                ...prevState,
                errors: newErrors,
                openedCards: [cardId], // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é (–ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–∫—Ä—ã–ª–∏—Å—å)
                moves: prevState.moves + 1,
                isGameOver: isGameLost
              };
            });
          }
        }
      };

      // üéÆ –°–±—Ä–æ—Å –∏–≥—Ä—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
      const resetGame = () => {
        setGameState({
          openedCards: [],
          matchedCards: [],
          moves: 0,
          errors: 0,
          isGameOver: false,
          isWin: false
        });
      };

      // üéØ –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–µ —Ö—Ä–∞–Ω–∏–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏!)
      const totalPairs = images.length / 2;
      const matchedPairs = gameState.matchedCards.length / 2;
      const progress = totalPairs > 0 ? (matchedPairs / totalPairs) * 100 : 0;
      const remainingLives = GAME_SETTINGS.LIVES_COUNT - gameState.errors;

      return (
        <section className="game container">
          <GameHeader 
            moves={gameState.moves}
            progress={progress}
            remainingLives={remainingLives}
            matchedPairs={matchedPairs}
            totalPairs={totalPairs}
          />
          
          <GameBoard 
            images={images}
            gameState={gameState}
            onCardClick={handleCardClick} 
          />

          {gameState.isGameOver && (
            <GameModal 
              isWin={gameState.isWin}
              moves={gameState.moves}
              matchedPairs={matchedPairs}
              onRestart={resetGame}
            />
          )}
        </section>
      );
    }

    // üìä –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —à–∞–ø–∫–∏ –∏–≥—Ä—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º (–æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ–¥ template)
    function GameHeader({ moves, progress, remainingLives, matchedPairs, totalPairs }) {
      return (
        <>
          <div className="progress-wrapper">
            <div className="progress" style={{ width: `${progress}%` }}></div>
          </div>
          <p className="progress-description">
            –û—Ç–∫—Ä—ã—Ç–æ <span>{matchedPairs}</span> / <span>{totalPairs}</span>
          </p>
          <div className="steps">–®–∞–≥ {moves}</div>
        </>
      );
    }

    // üéÆ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
    function GameBoard({ images = [], gameState, onCardClick }) {
      return (
        <ul className="cards cards-theme-cars">
          {images.map((item) => (
            <Card
              key={item.id}
              {...item}  // üéØ –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è: –ø–µ—Ä–µ–¥–∞–µ–º id, url, description
              isCardShow={gameState.openedCards.includes(item.id)}
              isCardFinished={gameState.matchedCards.includes(item.id)}
              onCardClick={onCardClick}
            />
          ))}
        </ul>
      );
    }

    // üé¥ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
    function Card({ id, url, description, isCardShow, isCardFinished, onCardClick }) {
      const cardClasses = `card ${isCardShow ? 'card-show' : ''} ${isCardFinished ? 'card-finished' : ''}`;
      
      return (
        <li 
          className={cardClasses} 
          onClick={() => onCardClick(id)}
        >
          <img src={url} width="204" height="144" alt={description} />
        </li>
      );
    }

    // üèÜ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (–æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ–¥ template)
    function GameModal({ isWin, moves, matchedPairs, onRestart }) {
      return (
        <div className="modal">
          <div className="modal-box">
            <h3 className="modal-caption">
              {isWin ? '–ü–æ–±–µ–¥–∞!' : '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞'}
            </h3>
            <p className="modal-description">
              {isWin 
                ? `–í—ã —Å–æ–±—Ä–∞–ª–∏ –≤—Å–µ –ø–∞—Ä—ã –∑–∞ ${moves} —à–∞–≥–æ–≤`
                : `–í—ã —Å–æ–±—Ä–∞–ª–∏ ${matchedPairs} –ø–∞—Ä`
              }
            </p>
            <button className="button modal-button" type="button" onClick={onRestart}>
              –ù–æ–≤–∞—è –∏–≥—Ä–∞
            </button>
          </div>
        </div>
      );
    }

  </script>
</body>
</html>