<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–≥—Ä–∞ –ú–µ–º–æ—Ä–∏. –ò–≥—Ä–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–∞–º—è—Ç–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–±–æ—Ä–∞—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="vendor/react.development.js"></script>
  <script src="vendor/react-dom.development.js"></script>
  <script src="vendor/babel.min.js"></script>
  <script src="js/data.js"></script>
  <script src="js/setting.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<App images={images}/>);


    function App ({images=[]}) {
     // üéØ –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –≤ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç (React best practice –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
     const [gameState, setGameState] = React.useState({
        openedCards: [],        // –û—Ç–∫—Ä—ã—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–º–∞–∫—Å–∏–º—É–º 2)
        matchedCards: [],       // –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫
        moves: 0,               // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö–æ–¥–æ–≤
        errors: 0,              // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
        isGameOver: false,      // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞?
        isWin: false           // –ò–≥—Ä–æ–∫ –ø–æ–±–µ–¥–∏–ª?
      });

    // useEffect: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç–æ 2 –∫–∞—Ä—Ç–æ—á–∫–∏
      React.useEffect(() => {
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ —Ä–æ–≤–Ω–æ 2 –∫–∞—Ä—Ç–æ—á–∫–∏ - –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        if (gameState.openedCards.length === 2) {
          const timer = setTimeout(() => {
            checkPair();
          }, GAME_SETTINGS.FLIP_DELAY); // 800ms –∑–∞–¥–µ—Ä–∂–∫–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫

          // üßπ –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
          return () => clearTimeout(timer);
        }
      }, [gameState.openedCards]); // –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: —Å–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ openedCards

      //–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫
      const checkPair = () => {
        const [cardId1, cardId2] = gameState.openedCards; // –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞

        // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –∏—Ö ID –≤ –º–∞—Å—Å–∏–≤–µ images
        const card1 = images.find(img => img.id === cardId1);
        const card2 = images.find(img => img.id === cardId2);

        // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
        const isPairMatch = card1.url === card2.url;

        if (isPairMatch) {
          // üéâ –ü–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞! –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
          setGameState(prevState => {
            const newMatchedCards = [...prevState.matchedCards, cardId1, cardId2];
            const totalCards = images.length;
            const isGameWon = newMatchedCards.length === totalCards; // –í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞–π–¥–µ–Ω—ã?

            return {
              ...prevState,
              matchedCards: newMatchedCards,
              openedCards: [], // –û—á–∏—â–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
              isWin: isGameWon,
              isGameOver: isGameWon // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø—Ä–∏ –ø–æ–±–µ–¥–µ
            };
          });
        } else {
          // üíî –ü–∞—Ä–∞ –Ω–µ –ø–æ–¥–æ—à–ª–∞! –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä–∞–∂–µ–Ω–∏–µ
          setGameState(prevState => {
            const newErrors = prevState.errors + 1;
            const isGameLost = newErrors >= GAME_SETTINGS.LIVES_COUNT; // –ö–æ–Ω—á–∏–ª–∏—Å—å –∂–∏–∑–Ω–∏?

            return {
              ...prevState,
              errors: newErrors,
              openedCards: [], // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
              isGameOver: isGameLost // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø—Ä–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–∏
            };
          });
        }
      };  
  
   // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
   const handleCardClick = (cardId) => {

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º: –º–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?
  const isCardAlreadyOpen = gameState.openedCards.includes(cardId);
  const isCardMatched = gameState.matchedCards.includes(cardId);
  const maxCardsOpen = gameState.openedCards.length >= 2;
  const gameIsOver = gameState.isGameOver;
  const remainingLives = GAME_SETTINGS.LIVES_COUNT - gameState.errors;

     // –ï—Å–ª–∏ –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ –∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞/–Ω–∞–π–¥–µ–Ω–∞, –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –º–∞–∫—Å–∏–º—É–º –∫–∞—Ä—Ç–æ—á–µ–∫ - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫
     if (gameIsOver || isCardAlreadyOpen || isCardMatched || maxCardsOpen) {
          return;
        }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∫ –æ—Ç–∫—Ä—ã—Ç—ã–º –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ö–æ–¥—ã
    setGameState(prevState => ({
          ...prevState,
          openedCards: [...prevState.openedCards, cardId],
          moves: prevState.moves + 1
        }));
      };

    // –°–±—Ä–æ—Å –∏–≥—Ä—ã –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
        const resetGame = () => {
        setGameState({
          openedCards: [],
          matchedCards: [],
          moves: 0,
          errors: 0,
          isGameOver: false,
          isWin: false
        });
      };

      // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è 
      const totalPairs = images.length / 2;
      const matchedPairs = gameState.matchedCards.length / 2;
      const progress = totalPairs > 0 ? (matchedPairs / totalPairs) * 100 : 0;
      const remainingLives = GAME_SETTINGS.LIVES_COUNT - gameState.errors;

      return (
        <section className="game container">
          <GameHeader 
            moves={gameState.moves}
            progress={progress}
            remainingLives={remainingLives}
          />
          
          <Grid 
            images={images}
            gameState={gameState}
            onCardClick={handleCardClick} 
          />

          {gameState.isGameOver && (
            <GameModal 
              isWin={gameState.isWin}
              moves={gameState.moves}
              matchedPairs={matchedPairs}
              onRestart={resetGame}
            />
          )}
        </section>
      );
    }

    // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —à–∞–ø–∫–∏ –∏–≥—Ä—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
    function GameHeader({ moves, progress, remainingLives }) {
      return (
        <>
          <div className="steps">–®–∞–≥ {moves}</div>
          <ProgressBar progress={progress} />
          <div className="lives">‚ù§Ô∏è {remainingLives}</div>
        </>
      );
    }

    // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
    function ProgressBar({ progress }) {
      return (
        <div className="progress">
          <div 
            className="progress-bar" 
            style={{ width: `${progress}%` }}
          ></div>
        </div>
      );
    }

    // üÉè –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–µ—Ç–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
    function Grid({ images = [], gameState, onCardClick }) {
      return (
        <ul className="cards cards-theme-cars">
          {images.map((item) => (
            <Card
              key={item.id}
              {...item}  // –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è: –ø–µ—Ä–µ–¥–∞–µ–º id, url, description
              isCardShow={gameState.openedCards.includes(item.id)}
              isCardFinished={gameState.matchedCards.includes(item.id)}
              onCardClick={onCardClick}
            />
          ))}
        </ul>
      );
    }

    // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
    function Card({ id, url, description, isCardShow, isCardFinished, onCardClick }) {
      const cardClasses = `card ${isCardShow ? 'card-show' : ''} ${isCardFinished ? 'card-finished' : ''}`;
      
      return (
        <li 
          className={cardClasses} 
          onClick={() => onCardClick(id)}
        >
          <img src={url} width="204" height="144" alt={description} />
        </li>
      );
    }

    // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
    function GameModal({ isWin, moves, matchedPairs, onRestart }) {
      return (
        <div className="modal-overlay">
          <div className="modal">
            <h2>{isWin ? 'üéâ –ü–æ–±–µ–¥–∞!' : 'üíî –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞'}</h2>
            <p>
              {isWin 
                ? `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —Å–æ–±—Ä–∞–ª–∏ –≤—Å–µ –ø–∞—Ä—ã –∑–∞ ${moves} —Ö–æ–¥–æ–≤!`
                : `–í—ã —Å–æ–±—Ä–∞–ª–∏ ${matchedPairs} –ø–∞—Ä –∏–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö.`
              }
            </p>
            <button onClick={onRestart} className="restart-button">
              –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
            </button>
          </div>
        </div>
      );
    }


  </script>
</body>
</html>

